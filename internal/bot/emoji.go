package bot

import (
	"regexp"
	"strings"
)

// 微信表情名 → QQ face ID 映射
var wxToQQFace = map[string]int{
	"微笑": 14, "撇嘴": 1, "色": 110, "发呆": 3, "得意": 4,
	"流泪": 5, "害羞": 6, "闭嘴": 7, "睡": 8, "大哭": 9,
	"尴尬": 10, "发怒": 11, "调皮": 12, "呲牙": 13, "惊讶": 0,
	"难过": 15, "酷": 16, "抓狂": 18, "吐": 19, "偷笑": 20,
	"可爱": 21, "白眼": 22, "傲慢": 23, "饥饿": 24, "困": 25,
	"惊恐": 26, "流汗": 27, "憨笑": 28, "悠闲": 29, "奋斗": 30,
	"咒骂": 31, "疑问": 32, "嘘": 33, "晕": 34, "折磨": 35,
	"衰": 36, "骷髅": 37, "敲打": 38, "再见": 39, "擦汗": 97,
	"抠鼻": 98, "鼓掌": 99, "糗大了": 100, "坏笑": 101, "左哼哼": 102,
	"右哼哼": 103, "哈欠": 104, "鄙视": 105, "委屈": 106, "快哭了": 107,
	"阴险": 108, "亲亲": 109, "吓": 111, "可怜": 112,
	"菜刀": 112, "啤酒": 113, "篮球": 114, "乒乓": 115, "咖啡": 60,
	"饭": 61, "猪头": 62, "玫瑰": 63, "凋谢": 64, "示爱": 65,
	"爱心": 66, "心碎": 67, "蛋糕": 68, "闪电": 69, "炸弹": 70,
	"刀": 71, "足球": 72, "瓢虫": 73, "便便": 74, "月亮": 75,
	"太阳": 76, "彩虹": 77, "拥抱": 78, "强": 79, "弱": 80,
	"握手": 81, "胜利": 82, "抱拳": 83, "勾引": 84, "拳头": 85,
	"差劲": 86, "爱你": 87, "NO": 88, "OK": 89, "爱情": 90,
	"飞吻": 91, "跳跳": 92, "发抖": 93, "怄火": 94, "转圈": 95,
	"磕头": 96, "捂脸": 264, "奸笑": 265, "机智": 277, "皱眉": 278,
	"耶": 279, "裂开": 342, "苦涩": 343, "叹气": 344, "让我看看": 345,
}

var wxEmojiRegex = regexp.MustCompile(`\[([^\[\]]+)\]`)
var brokenEmojiRegex = regexp.MustCompile(`\[([^\[\]]+)(?:\]|$)`)

// 微信表情 → Unicode emoji 映射
var wxToEmoji = map[string]string{
	"微笑": "😊", "撇嘴": "😖", "色": "😍", "发呆": "😳", "得意": "😎",
	"流泪": "😢", "害羞": "😊", "闭嘴": "🤐", "睡": "😴", "大哭": "😭",
	"尴尬": "😅", "发怒": "😡", "调皮": "😜", "呲牙": "😁", "惊讶": "😮",
	"难过": "😞", "酷": "😎", "抓狂": "😤", "吐": "🤮", "偷笑": "🤭",
	"可爱": "🥰", "白眼": "🙄", "傲慢": "😏", "困": "😪", "惊恐": "😨",
	"流汗": "😓", "憨笑": "😄", "悠闲": "😌", "奋斗": "💪", "咒骂": "🤬",
	"疑问": "❓", "嘘": "🤫", "晕": "😵", "衰": "😩", "敲打": "🔨",
	"再见": "👋", "擦汗": "😥", "鼓掌": "👏", "坏笑": "😏", "哈欠": "🥱",
	"委屈": "🥺", "快哭了": "🥺", "阴险": "😈", "亲亲": "😘", "吓": "😱",
	"可怜": "🥺", "玫瑰": "🌹", "爱心": "❤️", "心碎": "💔", "蛋糕": "🎂",
	"炸弹": "💣", "便便": "💩", "月亮": "🌙", "太阳": "☀️", "拥抱": "🤗",
	"强": "👍", "弱": "👎", "握手": "🤝", "胜利": "✌️", "拳头": "✊",
	"爱你": "🥰", "OK": "👌", "飞吻": "😽", "捂脸": "🤦", "奸笑": "😏",
	"机智": "🧐", "裂开": "💔", "苦涩": "😣", "叹气": "😮‍💨",
}

// ConvertWxEmoji 把微信格式 [表情名] 转换为 Unicode emoji
func ConvertWxEmoji(text string) string {
	return brokenEmojiRegex.ReplaceAllStringFunc(text, func(match string) string {
		name := strings.TrimPrefix(match, "[")
		name = strings.TrimSuffix(name, "]")
		name = strings.TrimSpace(name)
		if emoji, ok := wxToEmoji[name]; ok {
			return emoji
		}
		return match
	})
}
